<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine Surprise Maker ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --p: #ff6b95; --s: 'Dancing Script', cursive; --f: 'Pacifico', cursive; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, #fce4ec 0%, #e1bee7 100%);
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
            flex-direction: column; text-align: center; color: #444; padding: 20px;
            overflow-x: hidden;
        }

        .brand-logo { font-family: var(--f); font-size: 16px; color: rgba(216, 27, 96, 0.7); margin-bottom: 12px; }

        .card {
            background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(15px);
            border-radius: 30px; padding: 25px; width: 100%; max-width: 400px;
            box-shadow: 0 15px 35px rgba(255, 107, 149, 0.2); border: 1px solid white;
            transition: 0.5s;
        }

        /* Input Styles */
        input, textarea { 
            width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; 
            border: 1px solid #ffdae3; outline: none; font-size: 14px; background: rgba(255,255,255,0.8);
        }

        /* Stylish Buttons */
        .btn { border-radius: 25px; border: none; cursor: pointer; font-family: var(--s); font-size: 22px; transition: 0.3s; padding: 10px 20px; }
        .btn-p { background: linear-gradient(45deg, #ff3385, #ff6b95); color: white; box-shadow: 0 5px 15px rgba(255,51,133,0.3); width: 100%; }
        
        /* YES/NO Stylish Logic */
        #yesBtn { font-weight: bold; z-index: 100; display: inline-block; width: auto; min-width: 100px; }
        #noBtn { background: #eee; color: #888; display: inline-block; width: auto; min-width: 100px; }

        /* Upload Area */
        .upload-container {
            border: 2px dashed #bbb; border-radius: 15px; padding: 20px;
            margin: 15px 0; cursor: pointer; background: #fff;
        }
        .preview-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .preview-grid img { width: 100%; height: 70px; object-fit: cover; border-radius: 10px; border: 2px solid white; box-shadow: 0 3px 6px rgba(0,0,0,0.1); }

        .hidden { display: none !important; }

        /* Memories Section */
        .memories-btn { background: #fff; color: var(--p); border: 2.5px solid var(--p); font-family: var(--f); font-size: 18px; margin-top: 20px; padding: 15px; width: 100%; cursor: pointer; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: 0.3s; }
        .memories-btn:hover { background: var(--p); color: white; }

        .photo-gallery { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 20px; max-height: 300px; overflow-y: auto; padding: 5px; }
        .photo-gallery img { 
            width: 100%; border-radius: 15px; opacity: 0; transform: translateY(30px) rotate(5deg); 
            transition: 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 3px solid white; 
        }
        .photo-gallery img.show { opacity: 1; transform: translateY(0) rotate(0deg); }

        /* Slanted Stylish Text */
        .sweet-text {
            font-family: var(--s); font-size: 22px; color: #d81b60; margin: 20px 0;
            transform: rotate(-4deg); line-height: 1.3; font-weight: bold;
        }

        #muteBtn { position: fixed; top: 20px; right: 20px; background: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div class="brand-logo">Designed by @soumajit !! ‚ú®</div>
    <button id="muteBtn" onclick="toggleMute()">üéµ</button>
    <audio id="bgMusic" loop> <source src="music.mp3" type="audio/mpeg"> </audio>

    <div id="step-1" class="card">
        <h2 style="font-family: var(--f); color: var(--p); font-size: 22px;">Surprise Maker ‚ù§Ô∏è</h2>
        <input type="text" id="pName" placeholder="Partner's Name">
        <textarea id="pMsg" rows="3" placeholder="Write your special message..."></textarea>
        
        <div class="upload-container" onclick="document.getElementById('fileInput').click()">
            <p style="font-size: 13px; color: #777;">üì§ Click to upload 6 photos</p>
            <input type="file" id="fileInput" accept="image/*" multiple hidden>
        </div>
        <div id="previewGrid" class="preview-grid"></div>
        <button class="btn btn-p" onclick="generateSurprise()">Generate & Copy Link ‚ú®</button>
    </div>

    <div id="step-loading" class="card hidden">
        <h2 style="font-family: var(--f); color: var(--p);">Cuteness Loading...</h2>
        <h1 id="perc" style="font-size: 50px; color: var(--p); font-family: var(--f);">0%</h1>
        <button id="tapBtn" class="btn btn-p hidden" onclick="startTyping()">Tap to Open üíå</button>
    </div>

    <div id="step-typing" class="card hidden">
        <div id="animatedText" style="font-family: var(--s); font-size: 26px; color: #6a1b9a; min-height: 1.5em;"></div>
        <button id="nextBtn" class="btn btn-p hidden" style="margin-top: 25px;" onclick="showPropose()">Next ‚ú®</button>
    </div>

    <div id="step-propose" class="card hidden">
        <img src="panda.gif" style="width: 140px; margin-bottom: 10px; border-radius: 15px;">
        <h3 id="displayN" style="font-family: var(--f); color: var(--p); margin-bottom: 10px;"></h3>
        <p style="font-family: var(--s); font-size: 24px;">Will you be my Valentine? ü•∫</p>
        <div style="display: flex; gap: 20px; justify-content: center; margin-top: 40px; align-items: center;">
            <button class="btn btn-p" id="yesBtn" onclick="showSweetOption()">YES ü•∞</button>
            <button class="btn" id="noBtn" onmouseover="moveNo()">NO ü•∫</button>
        </div>
    </div>

    <div id="step-sweet-option" class="card hidden">
        <div class="sweet-text">
            I fell in love with you<br>
            because of the million<br>
            things you never knew<br>
            you were doing.
        </div>
        <button class="btn memories-btn" onclick="showFinalGallery()">‚ú® Sweet Memories ‚ú®</button>
    </div>

    <div id="step-final" class="card hidden">
        <h2 style="font-family: var(--f); color: var(--p); font-size: 22px;">Forever & Always ‚ú®</h2>
        <div id="finalGallery" class="photo-gallery"></div>
        <button class="btn btn-p" style="font-size: 16px; margin-top: 25px;" onclick="copyLink()">üîó Copy Surprise Link</button>
        <button class="btn" style="font-size: 12px; background:none; color:#888; width: 100%;" onclick="location.href=window.location.origin+window.location.pathname">Create New üéÅ</button>
    </div>

    <script>
        let pImgs = [];
        let yesSize = 1;
        const audio = document.getElementById('bgMusic');

        // ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶•‡¶æ‡¶Æ‡ßç‡¶¨‡¶®‡ßá‡¶á‡¶≤ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const files = Array.from(e.target.files).slice(0, 6);
            const grid = document.getElementById('previewGrid');
            grid.innerHTML = ''; pImgs = [];
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    pImgs.push(ev.target.result);
                    const img = document.createElement('img');
                    img.src = ev.target.result;
                    grid.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        });

        // URL ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has('n')) {
                document.getElementById('step-1').classList.add('hidden');
                document.getElementById('step-loading').classList.remove('hidden');
                let w = 0;
                const int = setInterval(() => {
                    w++; document.getElementById('perc').innerText = w + "%";
                    if(w >= 100) { clearInterval(int); document.getElementById('tapBtn').classList.remove('hidden'); }
                }, 30);
            }
        };

        function generateSurprise() {
            const n = document.getElementById('pName').value;
            const m = document.getElementById('pMsg').value;
            if(!n || !m || pImgs.length === 0) return alert("Please fill Name, Message and Upload Photos!");
            
            // ‡¶õ‡¶¨‡¶ø‡¶ó‡ßÅ‡¶≤‡ßã ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ (‡¶è‡¶ï‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
            localStorage.setItem('v_photos', JSON.stringify(pImgs));
            
            const url = `${window.location.origin}${window.location.pathname}?n=${encodeURIComponent(n)}&m=${encodeURIComponent(m)}`;
            navigator.clipboard.writeText(url);
            alert("Unique Link Copied! Send it to your partner. ‚ù§Ô∏è");
            window.location.href = url;
        }

        function startTyping() {
            audio.play().catch(() => {});
            document.getElementById('step-loading').classList.add('hidden');
            document.getElementById('step-typing').classList.remove('hidden');
            const params = new URLSearchParams(window.location.search);
            const msg = decodeURIComponent(params.get('m'));
            let i = 0;
            function type() {
                if(i < msg.length) {
                    document.getElementById('animatedText').innerHTML += msg.charAt(i);
                    i++; setTimeout(type, 60);
                } else { document.getElementById('nextBtn').classList.remove('hidden'); }
            }
            type();
        }

        function showPropose() {
            document.getElementById('step-typing').classList.add('hidden');
            document.getElementById('step-propose').classList.remove('hidden');
            const params = new URLSearchParams(window.location.search);
            document.getElementById('displayN').innerText = `To ${decodeURIComponent(params.get('n'))},`;
        }

        function moveNo() {
            const no = document.getElementById('noBtn');
            const yes = document.getElementById('yesBtn');
            
            // NO ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßÇ‡¶∞‡ßá ‡¶∏‡¶∞‡¶æ‡¶®‡ßã
            no.style.position = 'fixed';
            no.style.left = Math.random() * 70 + '%';
            no.style.top = Math.random() * 70 + '%';
            
            // YES ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¨‡ßú ‡¶ï‡¶∞‡¶æ
            yesSize += 0.35;
            yes.style.transform = `scale(${yesSize})`;
        }

        function showSweetOption() {
            document.getElementById('step-propose').classList.add('hidden');
            document.getElementById('step-sweet-option').classList.remove('hidden');
        }

        function showFinalGallery() {
            document.getElementById('step-sweet-option').classList.add('hidden');
            document.getElementById('step-final').classList.remove('hidden');
            const gallery = document.getElementById('finalGallery');
            const saved = localStorage.getItem('v_photos');
            if(saved) {
                const imgs = JSON.parse(saved);
                imgs.forEach((src, idx) => {
                    const img = document.createElement('img');
                    img.src = src;
                    gallery.appendChild(img);
                    setTimeout(() => img.classList.add('show'), 300 + (idx * 200));
                });
            }
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href);
            alert("Surprise Link Copied! ‚ù§Ô∏è");
        }

        function toggleMute() { audio.muted = !audio.muted; }
    </script>
</body>
</html>
