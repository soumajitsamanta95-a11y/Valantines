<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine Surprise Maker ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary-pink: #ff6b95; 
            --stylish-font: 'Dancing Script', cursive; 
            --fancy-font: 'Pacifico', cursive; 
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, #fce4ec 0%, #e1bee7 100%);
            height: 100vh; display: flex; justify-content: center; align-items: center;
            flex-direction: column; overflow: hidden; text-align: center; color: #444;
        }

        /* Brand Logo Signature */
        .brand-logo {
            font-family: var(--fancy-font);
            font-size: 16px;
            color: rgba(216, 27, 96, 0.7);
            margin-bottom: 12px;
            letter-spacing: 1px;
            animation: fadeInLogo 2s ease;
        }

        @keyframes fadeInLogo { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .card {
            background: rgba(255, 255, 255, 0.45); 
            backdrop-filter: blur(15px);
            border-radius: 35px; padding: 25px; width: 92%; max-width: 400px;
            box-shadow: 0 15px 35px rgba(255, 107, 149, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative; z-index: 10;
        }

        /* Improved Photo Animation */
        .photo-gallery { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 15px; max-height: 220px; overflow-y: auto; padding: 5px; }
        .photo-gallery img { 
            width: 100%; border-radius: 12px; opacity: 0; 
            transform: scale(0.3) rotate(-15deg); 
            transition: all 0.9s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            border: 3px solid white; box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        .photo-gallery img.show { opacity: 1; transform: scale(1) rotate(0deg); }

        .typing-text { font-family: var(--stylish-font); font-size: 26px; color: #6a1b9a; min-height: 1.5em; line-height: 1.3; }
        .letter-box { background: #fff9fa; border: 2px solid #ffcad4; border-radius: 20px; padding: 20px; margin-top: 10px; }
        .name-highlight { font-family: var(--fancy-font); color: #d81b60; font-size: 28px; display: block; }

        .btn { border-radius: 30px; border: none; cursor: pointer; transition: 0.3s; font-family: var(--stylish-font); font-size: 22px; width: 100%; margin-top: 10px; padding: 10px; }
        .btn-pink { background: linear-gradient(45deg, #ff3385, #ff6b95); color: white; box-shadow: 0 4px 15px rgba(255, 51, 133, 0.3); }

        input, textarea { 
            width: 100%; padding: 12px; margin: 8px 0; border-radius: 15px; border: 1.5px solid #ffdae3; 
            outline: none; background: rgba(255, 255, 255, 0.7); font-family: var(--stylish-font); font-size: 18px;
        }

        #muteBtn {
            position: fixed; top: 20px; right: 20px; width: 40px; height: 40px; border-radius: 50%;
            background: white; border: none; cursor: pointer; z-index: 1000; font-size: 18px;
            display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .hidden { display: none !important; }

        .final-quote {
            font-family: var(--stylish-font); font-size: 19px; color: #d81b60; font-style: italic;
            margin-top: 15px; opacity: 0; transform: rotate(-3deg); transition: 2.5s ease;
        }
        .final-quote.show { opacity: 1; }
    </style>
</head>
<body>

    <div class="brand-logo">Designed by @soumajit !! ‚ú®</div>
    <button id="muteBtn" onclick="toggleMute()">üéµ</button>
    <audio id="bgMusic" loop> <source src="music.mp3" type="audio/mpeg"> </audio>

    <div id="step-1" class="card">
        <h2 style="font-family: var(--fancy-font); color: var(--primary-pink); font-size: 22px;">Surprise Maker ‚ù§Ô∏è</h2>
        <input type="text" id="pName" placeholder="Partner's Name">
        <textarea id="pMsg" rows="2" placeholder="Write a romantic message..."></textarea>
        <p style="font-size: 11px; color: var(--primary-pink); margin-top: 5px;">Paste 6 Photo Links (One per line):</p>
        <textarea id="imgUrls" rows="4" placeholder="https://site.com/photo1.jpg&#10;https://site.com/photo2.jpg"></textarea>
        <button class="btn btn-pink" onclick="generateSurprise()">Generate & Copy Link ‚ú®</button>
    </div>

    <div id="step-loading" class="card hidden">
        <h2 style="font-family: var(--fancy-font); color: var(--primary-pink);">Loading Magic...</h2>
        <h1 id="perc" style="font-size: 50px; color: var(--primary-pink); font-family: var(--fancy-font);">0%</h1>
        <button id="tapBtn" class="btn hidden" style="background:white; color:#ff3385;" onclick="startTyping()">Tap to Open üíå</button>
    </div>

    <div id="step-typing" class="card hidden">
        <div style="font-size:40px; margin-bottom:10px;">üíñ</div>
        <div id="animatedText" class="typing-text"></div>
        <button id="nextBtn" class="btn btn-pink hidden" onclick="showPropose()">Next ‚ú®</button>
    </div>

    <div id="step-propose" class="card hidden">
        <img src="panda.gif" style="width: 120px; margin-bottom: 10px; border-radius: 15px;">
        <div class="letter-box">
            <span id="displayPartnerName" class="name-highlight"></span>
            <p style="font-family: var(--stylish-font); font-size: 22px; color: var(--primary-pink);">Will you be my Valentine? ü•∫</p>
        </div>
        <button class="btn btn-pink" onclick="showFinal()">YES ü•∞</button>
        <button id="noBtn" class="btn" style="background:#eee; color:#888;" onmouseover="moveNo()">NO ü•∫</button>
    </div>

    <div id="step-final" class="card hidden">
        <h2 id="galleryTitle" style="font-family: var(--fancy-font); color: var(--primary-pink); font-size: 20px;"></h2>
        <div id="photoGallery" class="photo-gallery"></div>
        <p id="finalQuoteText" class="final-quote">
            "I fell in love with you because of the million things you never knew you were doing."
        </p>
        <h3 class="name-highlight" style="margin-top:10px; font-size: 22px;">Forever Yours! ‚ù§Ô∏è</h3>
        <button class="btn btn-pink" style="font-size: 16px;" onclick="copyCurrentLink()">üîó Copy Surprise Link</button>
        <button class="btn" style="font-size: 12px; background:none; color:#888;" onclick="location.href=window.location.origin+window.location.pathname">Create New üéÅ</button>
    </div>

    <script>
        let pName = "", pMsg = "", pPhotos = [];
        const audio = document.getElementById('bgMusic');

        // Check URL for data on load
        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has('n')) {
                pName = decodeURIComponent(params.get('n'));
                pMsg = decodeURIComponent(params.get('m'));
                const photos = params.get('p');
                if(photos) pPhotos = photos.split(',');

                document.getElementById('step-1').classList.add('hidden');
                document.getElementById('step-loading').classList.remove('hidden');
                runLoading();
            }
        };

        function generateSurprise() {
            const name = document.getElementById('pName').value;
            const msg = document.getElementById('pMsg').value;
            const urls = document.getElementById('imgUrls').value.split('\n').filter(u => u.trim() !== "").join(',');

            if(!name || !msg || !urls) return alert("Please fill all the boxes!");

            const finalUrl = `${window.location.origin}${window.location.pathname}?n=${encodeURIComponent(name)}&m=${encodeURIComponent(msg)}&p=${encodeURIComponent(urls)}`;
            
            navigator.clipboard.writeText(finalUrl);
            alert("Success! Your unique surprise link is ready and copied to clipboard. üîó");
            window.location.href = finalUrl;
        }

        function runLoading() {
            let w = 0;
            const int = setInterval(() => {
                w++;
                document.getElementById('perc').innerText = w + "%";
                if(w >= 100) { clearInterval(int); document.getElementById('tapBtn').classList.remove('hidden'); }
            }, 30);
        }

        function startTyping() {
            audio.play().catch(() => {});
            document.getElementById('step-loading').classList.add('hidden');
            document.getElementById('step-typing').classList.remove('hidden');
            let i = 0;
            function type() {
                if (i < pMsg.length) {
                    document.getElementById('animatedText').innerHTML += pMsg.charAt(i);
                    i++; setTimeout(type, 70);
                } else { document.getElementById('nextBtn').classList.remove('hidden'); }
            }
            type();
        }

        function showPropose() {
            document.getElementById('step-typing').classList.add('hidden');
            document.getElementById('step-propose').classList.remove('hidden');
            document.getElementById('displayPartnerName').innerText = pName;
        }

        function showFinal() {
            document.getElementById('step-propose').classList.add('hidden');
            document.getElementById('step-final').classList.remove('hidden');
            document.getElementById('galleryTitle').innerText = `${pName}'s Memories ‚ú®`;
            
            const gallery = document.getElementById('photoGallery');
            gallery.innerHTML = '';
            pPhotos.forEach((src, idx) => {
                const img = document.createElement('img');
                img.src = src.trim();
                img.onerror = () => img.src = "https://via.placeholder.com/150/ff6b95/ffffff?text=‚ù§Ô∏è";
                gallery.appendChild(img);
                setTimeout(() => img.classList.add('show'), 400 + (idx * 300));
            });
            setTimeout(() => document.getElementById('finalQuoteText').classList.add('show'), 1500);
        }

        function copyCurrentLink() {
            navigator.clipboard.writeText(window.location.href);
            alert("Link Copied! ‚ù§Ô∏è");
        }

        function toggleMute() { audio.muted = !audio.muted; }
        
        function moveNo() {
            const b = document.getElementById('noBtn');
            b.style.position = 'fixed';
            b.style.left = Math.random() * 70 + '%'; b.style.top = Math.random() * 70 + '%';
        }
    </script>
</body>
</html>
