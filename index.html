<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Valentine Surprise ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --p: #ff4d94; --s: 'Dancing Script', cursive; --f: 'Pacifico', cursive; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, #fce4ec 0%, #e1bee7 100%);
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
            flex-direction: column; text-align: center; color: #444; overflow: hidden;
            position: relative;
        }

        /* Floating Stars Animation */
        .star { position: absolute; color: #ffeb3b; font-size: 15px; animation: float 6s linear infinite; opacity: 0.8; z-index: 0; }
        @keyframes float {
            0% { transform: translateY(110vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }

        .brand-logo { font-family: var(--f); font-size: 16px; color: rgba(216, 27, 96, 0.7); margin-bottom: 12px; z-index: 10; }

        .card {
            background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(15px);
            border-radius: 30px; padding: 30px; width: 90%; max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.6);
            animation: fadeIn 0.8s ease; z-index: 10; position: relative;
        }

        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        .btn-bar {
            background: white; color: var(--p); border-radius: 50px; padding: 15px;
            font-family: var(--s); font-size: 20px; width: 100%; border: none;
            cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-top: 20px;
        }

        .btn-row { display: flex; gap: 20px; justify-content: center; margin-top: 30px; position: relative; min-height: 60px; }
        .yes-btn { background: #4caf50; color: white; border-radius: 50px; padding: 12px 30px; font-size: 20px; border: none; cursor: pointer; z-index: 11; transition: 0.3s; }
        .no-btn { background: #f44336; color: white; border-radius: 50px; padding: 12px 30px; font-size: 20px; border: none; cursor: pointer; transition: 0.1s ease-out; position: absolute; z-index: 10; }

        .typing { font-family: var(--s); font-size: 22px; color: #d81b60; line-height: 1.5; min-height: 60px; }

        .photo-gallery { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .photo-gallery img { width: 100%; border-radius: 15px; border: 4px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); opacity: 0; transform: scale(0.8); transition: 0.6s ease forwards; }
        .photo-gallery img.show { opacity: 1; transform: scale(1); }

        .hidden { display: none !important; }
        #muteBtn { position: fixed; bottom: 20px; right: 20px; background: white; border-radius: 50%; width: 45px; height: 45px; border: none; cursor: pointer; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .pink-heart { color: var(--p); font-size: 60px; margin-bottom: 10px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    </style>
</head>
<body>

    <div class="brand-logo">Designed by @soumajit !! ‚ú®</div>
    <button id="muteBtn" onclick="toggleMute()">üéµ</button>
    <audio id="bgMusic" loop> <source src="music.mp3" type="audio/mpeg"> </audio>

    <div id="step-1" class="card">
        <h2 style="font-family: var(--f); color: var(--p);">Surprise Maker ‚ù§Ô∏è</h2>
        <input type="text" id="pName" placeholder="Partner Name" style="width:100%; padding:12px; margin:10px 0; border-radius:12px; border:1px solid #ddd; outline:none;">
        <textarea id="pMsg" placeholder="Write a romantic message..." rows="3" style="width:100%; padding:12px; margin:10px 0; border-radius:12px; border:1px solid #ddd; outline:none; resize:none;"></textarea>
        <div id="dropZone" style="border: 2px dashed #ff4d94; padding: 20px; border-radius: 15px; cursor: pointer;" onclick="document.getElementById('fileInput').click()">
            <p id="upTxt" style="font-size: 14px; color: #ff4d94; font-weight: bold;">üì§ Upload 6 Photos</p>
            <input type="file" id="fileInput" accept="image/*" multiple hidden>
        </div>
        <button class="btn-bar" id="genBtn" onclick="generateLink()" style="background: var(--p); color: white;">Generate & Copy Link ‚ú®</button>
    </div>

    <div id="step-loading" class="card hidden">
        <div class="pink-heart">üíñ</div>
        <h2 style="color: var(--p); font-family: var(--s); font-size: 32px;">Loading...</h2>
        <h1 id="perc" style="font-family: var(--f); color: var(--p); font-size: 45px;">0%</h1>
    </div>

    <div id="step-tap" class="card hidden">
        <div class="pink-heart" style="color: red;">‚ù§Ô∏è</div>
        <h2 style="color: red; font-family: var(--s); font-size: 32px;">Cuteness Overload...</h2>
        <button class="btn-bar" onclick="startSurprise()">Tap to Open üíå</button>
    </div>

    <div id="step-heart-anim" class="card hidden">
        <div style="font-size: 50px;">‚ú®üíñ‚ú®</div>
        <h2 style="font-family: var(--s); font-size: 30px; color: var(--p); margin-top: 15px;">My heart opens for you... ‚ú®</h2>
    </div>

    <div id="step-propose" class="card hidden">
        <img src="https://media.tenor.com/79_u2v7iN3oAAAAj/bear-panda.gif" style="width: 130px;">
        <p id="proposeName" style="font-family: var(--f); color: var(--p); font-size: 22px;"></p>
        <p style="font-family: var(--s); font-size: 28px;">Will you be my Valentine? ü•∫</p>
        <div class="btn-row">
            <button class="yes-btn" id="yesBtn" onclick="showTypingMsg()">YES ü•∞</button>
            <button class="no-btn" id="noBtn" onmouseover="moveNo()" ontouchstart="moveNo()">NO ü•∫</button>
        </div>
    </div>

    <div id="step-typing" class="card hidden">
        <div class="typing" id="typingArea"></div>
        <button class="btn-bar hidden" id="sweetMemBtn" onclick="showGallery()">Sweet Memories üíñ</button>
    </div>

    <div id="step-final" class="card hidden">
        <div id="finalGallery" class="photo-gallery"></div>
        <p style="font-family: var(--s); font-size: 26px; margin-top: 20px; color: var(--p);">Forever Yours! ‚ù§Ô∏è</p>
    </div>

    <script>
        let pImgs = [];
        let yesScale = 1;
        const audio = document.getElementById('bgMusic');

        function createStars() {
            for (let i = 0; i < 30; i++) {
                let star = document.createElement('div');
                star.className = 'star';
                star.innerHTML = i % 2 === 0 ? '‚òÖ' : '‚ú®';
                star.style.left = Math.random() * 100 + 'vw';
                star.style.animationDuration = (Math.random() * 3 + 4) + 's';
                document.body.appendChild(star);
            }
        }
        createStars();

        // ‚ö° ‡¶Ö‡¶§‡ßç‡¶Ø‡¶æ‡¶ß‡ßÅ‡¶®‡¶ø‡¶ï ‡¶á‡¶Æ‡ßá‡¶ú ‡¶ï‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡ßá‡¶∏‡¶∞ (MB ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
        async function compressImage(base64Str) {
            return new Promise((resolve) => {
                const img = new Image();
                img.src = base64Str;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 300; // ‡¶∏‡¶æ‡¶á‡¶ú ‡¶Ü‡¶∞‡¶ì ‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá‡¶∞ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ‡¶∞‡ßç‡¶•‡ßá
                    const scaleSize = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scaleSize;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    resolve(canvas.toDataURL('image/jpeg', 0.4)); // ‡¶ï‡ßã‡ßü‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø ‡ß™‡ß¶% ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶≤‡ßã
                };
            });
        }

        document.getElementById('fileInput').addEventListener('change', async function(e) {
            const files = Array.from(e.target.files).slice(0, 6);
            if(files.length === 0) return;
            
            const upTxt = document.getElementById('upTxt');
            const genBtn = document.getElementById('genBtn');
            
            upTxt.innerText = "‚è≥ Compressing... Please wait!";
            genBtn.disabled = true;
            genBtn.style.opacity = "0.5";
            
            pImgs = [];
            for (let file of files) {
                const reader = new FileReader();
                const raw = await new Promise(r => { 
                    reader.onload = e => r(e.target.result); 
                    reader.readAsDataURL(file); 
                });
                const compressed = await compressImage(raw);
                pImgs.push(compressed);
            }
            
            upTxt.innerText = "‚úÖ " + pImgs.length + " Photos Compressed!";
            genBtn.disabled = false;
            genBtn.style.opacity = "1";
        });

        function generateLink() {
            const n = document.getElementById('pName').value;
            const m = document.getElementById('pMsg').value;
            
            if(!n || !m || pImgs.length === 0) {
                alert("Please fill Name, Message and select Photos!");
                return;
            }
            
            const data = { n, m, i: pImgs };
            try {
                const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
                const url = window.location.origin + window.location.pathname + "?v=" + encoded;
                
                if(url.length > 8000) {
                    alert("‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶Ö‡¶®‡ßá‡¶ï ‡¶¨‡ßú ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá! ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ï‡¶Æ ‡¶∏‡¶æ‡¶á‡¶ú‡ßá‡¶∞ ‡¶¨‡¶æ ‡¶ï‡¶Æ ‡¶õ‡¶¨‡¶ø (‡¶Ø‡ßá‡¶Æ‡¶® ‡ß™‡¶ü‡¶ø) ‡¶¶‡¶ø‡ßü‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                    return;
                }
                
                navigator.clipboard.writeText(url).then(() => {
                    alert("Link Generated & Copied! ‚ù§Ô∏è");
                });
            } catch (e) {
                alert("Error generating link. Try with smaller images.");
            }
        }

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has('v')) {
                const data = JSON.parse(decodeURIComponent(escape(atob(params.get('v')))));
                window.pData = data;
                document.getElementById('step-1').classList.add('hidden');
                document.getElementById('step-loading').classList.remove('hidden');
                let w = 0;
                let int = setInterval(() => {
                    w += 2; 
                    document.getElementById('perc').innerText = w + "%";
                    if(w >= 100) { 
                        clearInterval(int); 
                        document.getElementById('step-loading').classList.add('hidden'); 
                        document.getElementById('step-tap').classList.remove('hidden'); 
                    }
                }, 50);
            }
        };

        function startSurprise() {
            audio.play().catch(() => {});
            document.getElementById('step-tap').classList.add('hidden');
            document.getElementById('step-heart-anim').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('step-heart-anim').classList.add('hidden');
                document.getElementById('step-propose').classList.remove('hidden');
                document.getElementById('proposeName').innerText = "To " + window.pData.n;
            }, 2500);
        }

        function moveNo() {
            const no = document.getElementById('noBtn');
            const yes = document.getElementById('yesBtn');
            no.style.left = Math.random() * 80 + '%';
            no.style.top = (Math.random() * 400 - 200) + 'px';
            yesScale += 0.15;
            yes.style.transform = `scale(${yesScale})`;
        }

        function showTypingMsg() {
            document.getElementById('step-propose').classList.add('hidden');
            document.getElementById('step-typing').classList.remove('hidden');
            let text = window.pData.m;
            let i = 0;
            function type() {
                if (i < text.length) {
                    document.getElementById('typingArea').innerHTML += text.charAt(i);
                    i++; setTimeout(type, 60);
                } else {
                    document.getElementById('sweetMemBtn').classList.remove('hidden');
                }
            }
            type();
        }

        function showGallery() {
            document.getElementById('step-typing').classList.add('hidden');
            document.getElementById('step-final').classList.remove('hidden');
            const gal = document.getElementById('finalGallery');
            window.pData.i.forEach((src, idx) => {
                const img = document.createElement('img');
                img.src = src;
                gal.appendChild(img);
                setTimeout(() => img.classList.add('show'), idx * 300);
            });
        }

        function toggleMute() { audio.muted = !audio.muted; }
    </script>
</body>
</html>
