<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine Surprise ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --p: #ff6b95; --s: 'Dancing Script', cursive; --f: 'Pacifico', cursive; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(180deg, #fce4ec 0%, #e1bee7 100%);
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
            flex-direction: column; text-align: center; color: #444; padding: 20px;
            overflow-x: hidden;
        }

        .brand-logo { font-family: var(--f); font-size: 16px; color: rgba(216, 27, 96, 0.7); margin-bottom: 12px; }

        .card {
            background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(15px);
            border-radius: 30px; padding: 25px; width: 100%; max-width: 400px;
            box-shadow: 0 15px 35px rgba(255, 107, 149, 0.2); border: 1px solid white;
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Generator Section */
        .upload-area { border: 2px dashed #bbb; border-radius: 15px; padding: 20px; margin: 15px 0; cursor: pointer; background: #fff; }
        .preview-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .preview-grid img { width: 100%; height: 70px; object-fit: cover; border-radius: 8px; border: 2px solid white; }

        /* Loading & Heart */
        #perc { font-size: 50px; color: var(--p); font-family: var(--f); margin: 10px 0; }
        .heart-container { position: relative; width: 100px; height: 90px; margin: 30px auto; }
        .heart { position: absolute; width: 50px; height: 80px; background: var(--p); border-radius: 50px 50px 0 0; transition: 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .heart.left { left: 10px; transform: rotate(-45deg); transform-origin: 100% 100%; }
        .heart.right { left: 40px; transform: rotate(45deg); transform-origin: 0 100%; }
        .heart.open-left { transform: rotate(-120deg); }
        .heart.open-right { transform: rotate(120deg); }

        /* Buttons */
        .btn { border-radius: 25px; border: none; cursor: pointer; font-family: var(--s); font-size: 22px; transition: 0.3s; padding: 12px 25px; }
        .btn-p { background: linear-gradient(45deg, #ff3385, #ff6b95); color: white; box-shadow: 0 5px 15px rgba(255,51,133,0.3); width: 100%; }
        #yesBtn { display: inline-block; width: auto; z-index: 100; transition: 0.2s; }
        #noBtn { background: #eee; color: #888; display: inline-block; width: auto; position: relative; }

        /* Stylish Slanted Text */
        .sweet-text {
            font-family: var(--s); font-size: 20px; color: #d81b60; margin: 20px 0;
            transform: rotate(-5deg); line-height: 1.3; font-weight: bold;
        }

        .photo-gallery { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .photo-gallery img { width: 100%; border-radius: 15px; opacity: 0; transform: scale(0.5); transition: 0.8s ease; border: 3px solid white; }
        .photo-gallery img.show { opacity: 1; transform: scale(1); }

        .hidden { display: none !important; }
        #muteBtn { position: fixed; top: 20px; right: 20px; background: white; border-radius: 50%; width: 40px; height: 40px; border: none; cursor: pointer; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div class="brand-logo">Designed by @soumajit !! ‚ú®</div>
    <button id="muteBtn" onclick="toggleMute()">üéµ</button>
    <audio id="bgMusic" loop> <source src="music.mp3" type="audio/mpeg"> </audio>

    <div id="step-1" class="card">
        <h2 style="font-family: var(--f); color: var(--p);">Surprise Maker ‚ù§Ô∏è</h2>
        <input type="text" id="pName" placeholder="Partner's Name" style="width:100%; padding:12px; margin:10px 0; border-radius:12px; border:1px solid #ddd;">
        <textarea id="pMsg" placeholder="Write a romantic message..." rows="3" style="width:100%; padding:12px; margin:10px 0; border-radius:12px; border:1px solid #ddd;"></textarea>
        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <p id="upTxt" style="font-size: 13px; color: #777;">üì§ Click to upload 6 photos</p>
            <input type="file" id="fileInput" accept="image/*" multiple hidden>
        </div>
        <div id="previewGrid" class="preview-grid"></div>
        <button class="btn btn-p" onclick="generateSurprise()" style="margin-top:10px;">Generate & Copy Link ‚ú®</button>
    </div>

    <div id="step-loading" class="card hidden">
        <p style="font-family: var(--f); color: var(--p);">Loading your cuteness...</p>
        <p style="font-size:13px; color:#888;">a beautiful surprise is loading...</p>
        <h1 id="perc">0%</h1>
    </div>

    <div id="step-tap" class="card hidden">
        <h2 style="font-family: var(--f); color: var(--p);">Hold on its too much!</h2>
        <button class="btn btn-p" style="margin-top:20px;" onclick="startHeartAnim()">Tap to Open üíå</button>
    </div>

    <div id="step-heart" class="card hidden">
        <h2 style="font-family: var(--s); font-size: 28px; color: var(--p);">Preparing My Heart...</h2>
        <div class="heart-container">
            <div class="heart left" id="hL"></div>
            <div class="heart right" id="hR"></div>
        </div>
        <p id="hTag" style="font-family: var(--s); opacity:0; transition:1s;">My heart open for you ‚ù§Ô∏è</p>
    </div>

    <div id="step-msg-page" class="card hidden">
        <img src="panda.gif" style="width: 100px; margin-bottom: 15px; border-radius: 10px;">
        <div id="displayMsg" style="font-style: italic; color: #555; margin-bottom: 20px; border-left: 4px solid var(--p); padding-left: 10px; text-align: left;"></div>
        <button class="btn btn-p" onclick="showPropose()">Next ‚ú®</button>
    </div>

    <div id="step-propose" class="card hidden">
        <img src="panda.gif" style="width: 120px; margin-bottom: 10px;">
        <p id="toName" style="font-family: var(--f); color: var(--p); font-size: 18px;"></p>
        <p style="font-family: var(--s); font-size: 26px;">Will you be my Valentine? ü•∫</p>
        <div style="display:flex; gap:20px; justify-content:center; margin-top:30px; align-items:center;">
            <button class="btn btn-p" id="yesBtn" onclick="showSweetOption()">YES ü•∞</button>
            <button class="btn" id="noBtn" onmouseover="moveNo()">NO ü•∫</button>
        </div>
    </div>

    <div id="step-sweet-option" class="card hidden">
        <div class="sweet-text">
            I fell in love with you<br>
            because of the million<br>
            things you never knew<br>
            you were doing.
        </div>
        <button class="btn btn-p" onclick="showFinalGallery()">üíñ Sweet Memories üíñ</button>
    </div>

    <div id="step-final" class="card hidden">
        <h2 style="font-family: var(--f); color: var(--p);">Our Journey ‚ú®</h2>
        <div id="finalGallery" class="photo-gallery"></div>
        <p style="font-family: var(--s); font-size: 20px; margin-top: 20px; color: var(--p);">Forever Yours! ‚ù§Ô∏è</p>
        <button class="btn btn-p" style="margin-top:20px; font-size:16px;" onclick="copyLink()">üîó Share Again</button>
    </div>

    <script>
        let pImgs = [];
        let yesScale = 1;
        const audio = document.getElementById('bgMusic');

        // Image Compressor Logic
        async function compressImage(base64Str) {
            return new Promise((resolve) => {
                const img = new Image();
                img.src = base64Str;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 400; 
                    const scaleSize = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scaleSize;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    resolve(canvas.toDataURL('image/jpeg', 0.6));
                };
            });
        }

        document.getElementById('fileInput').addEventListener('change', async function(e) {
            const files = Array.from(e.target.files).slice(0, 6);
            const grid = document.getElementById('previewGrid');
            const upTxt = document.getElementById('upTxt');
            grid.innerHTML = '<p style="font-size:12px; color:var(--p);">Compressing photos...</p>';
            pImgs = [];

            for (let file of files) {
                const reader = new FileReader();
                const result = await new Promise((resolve) => {
                    reader.onload = (ev) => resolve(ev.target.result);
                    reader.readAsDataURL(file);
                });
                const compressed = await compressImage(result);
                pImgs.push(compressed);
            }
            grid.innerHTML = '';
            pImgs.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                grid.appendChild(img);
            });
            upTxt.innerText = `Photos Uploaded: ${pImgs.length}`;
        });

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has('n')) {
                const savedImgs = localStorage.getItem('temp_imgs');
                if(savedImgs) pImgs = JSON.parse(savedImgs);
                document.getElementById('step-1').classList.add('hidden');
                document.getElementById('step-loading').classList.remove('hidden');
                let w = 0;
                const int = setInterval(() => {
                    w++; document.getElementById('perc').innerText = w + "%";
                    if(w >= 100) { 
                        clearInterval(int);
                        document.getElementById('step-loading').classList.add('hidden');
                        document.getElementById('step-tap').classList.remove('hidden');
                    }
                }, 40);
            }
        };

        function generateSurprise() {
            const n = document.getElementById('pName').value;
            const m = document.getElementById('pMsg').value;
            if(!n || !m || pImgs.length === 0) return alert("Please fill Name, Message and 6 Photos!");

            try {
                localStorage.setItem('temp_imgs', JSON.stringify(pImgs));
                const url = `${window.location.origin}${window.location.pathname}?n=${encodeURIComponent(n)}&m=${encodeURIComponent(m)}`;
                navigator.clipboard.writeText(url);
                alert("Link Copied Successfully! ‚ù§Ô∏è");
                window.location.href = url;
            } catch (e) {
                alert("Too much data! Try using fewer photos or smaller ones.");
            }
        }

        function startHeartAnim() {
            audio.play().catch(() => {});
            document.getElementById('step-tap').classList.add('hidden');
            document.getElementById('step-heart').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('hL').classList.add('open-left');
                document.getElementById('hR').classList.add('open-right');
                document.getElementById('hTag').style.opacity = "1";
                setTimeout(() => {
                    document.getElementById('step-heart').classList.add('hidden');
                    showCustomMsg();
                }, 2500);
            }, 800);
        }

        function showCustomMsg() {
            document.getElementById('step-msg-page').classList.remove('hidden');
            const params = new URLSearchParams(window.location.search);
            document.getElementById('displayMsg').innerText = decodeURIComponent(params.get('m'));
        }

        function showPropose() {
            document.getElementById('step-msg-page').classList.add('hidden');
            document.getElementById('step-propose').classList.remove('hidden');
            const params = new URLSearchParams(window.location.search);
            document.getElementById('toName').innerText = `To ${decodeURIComponent(params.get('n'))},`;
        }

        function moveNo() {
            const no = document.getElementById('noBtn');
            const yes = document.getElementById('yesBtn');
            no.style.position = 'fixed';
            no.style.left = Math.random() * 70 + '%';
            no.style.top = Math.random() * 70 + '%';
            yesScale += 0.4;
            yes.style.transform = `scale(${yesScale})`;
        }

        function showSweetOption() {
            document.getElementById('step-propose').classList.add('hidden');
            document.getElementById('step-sweet-option').classList.remove('hidden');
        }

        function showFinalGallery() {
            document.getElementById('step-sweet-option').classList.add('hidden');
            document.getElementById('step-final').classList.remove('hidden');
            const gallery = document.getElementById('finalGallery');
            pImgs.forEach((src, idx) => {
                const img = document.createElement('img');
                img.src = src;
                gallery.appendChild(img);
                setTimeout(() => img.classList.add('show'), 300 + (idx * 200));
            });
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href);
            alert("Link Copied! ‚ù§Ô∏è");
        }

        function toggleMute() { audio.muted = !audio.muted; }
    </script>
</body>
</html>
