<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine Surprise ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --p: #ff6b95; --s: 'Dancing Script', cursive; --f: 'Pacifico', cursive; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Poppins', sans-serif; background: linear-gradient(180deg, #fce4ec 0%, #e1bee7 100%);
            height: 100vh; display: flex; justify-content: center; align-items: center;
            flex-direction: column; overflow: hidden; text-align: center; color: #444;
        }
        .brand-logo { font-family: var(--f); font-size: 16px; color: rgba(216, 27, 96, 0.7); margin-bottom: 10px; }
        .card {
            background: rgba(255, 255, 255, 0.45); backdrop-filter: blur(15px);
            border-radius: 35px; padding: 25px; width: 92%; max-width: 400px;
            box-shadow: 0 15px 35px rgba(255, 107, 149, 0.2); border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative; z-index: 10;
        }
        .photo-gallery { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 15px; max-height: 220px; overflow-y: auto; padding: 5px; }
        .photo-gallery img { 
            width: 100%; border-radius: 12px; opacity: 0; transform: scale(0.3) rotate(-15deg); 
            transition: all 0.9s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .photo-gallery img.show { opacity: 1; transform: scale(1) rotate(0deg); }
        .typing-text { font-family: var(--s); font-size: 26px; color: #6a1b9a; min-height: 1.2em; }
        .letter-box { background: #fff9fa; border: 2px solid #ffcad4; border-radius: 20px; padding: 20px; margin-top: 10px; }
        .name-h { font-family: var(--f); color: #d81b60; font-size: 28px; }
        .btn { border-radius: 30px; border: none; cursor: pointer; transition: 0.3s; font-family: var(--s); font-size: 22px; width: 100%; margin-top: 10px; padding: 10px; }
        .btn-p { background: linear-gradient(45deg, #ff3385, #ff6b95); color: white; }
        #muteBtn { position: fixed; top: 20px; right: 20px; width: 40px; height: 40px; border-radius: 50%; background: white; border: none; z-index: 1000; cursor: pointer; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border-radius: 15px; border: 1px solid #ffdae3; outline: none; font-family: var(--s); font-size: 18px; }
        .hidden { display: none !important; }
        .final-quote { font-family: var(--s); font-size: 19px; color: #d81b60; font-style: italic; margin-top: 15px; opacity: 0; transition: 2.5s; transform: rotate(-3deg); }
        .final-quote.show { opacity: 1; }
    </style>
</head>
<body>

    <div class="brand-logo">Designed by @soumajit !! ‚ú®</div>
    <button id="muteBtn" onclick="toggleMute()">üéµ</button>
    <audio id="bgMusic" loop> <source src="music.mp3" type="audio/mpeg"> </audio>

    <div id="step-1" class="card">
        <h2 style="font-family: var(--f); color: var(--p);">Valentine Creator ‚ù§Ô∏è</h2>
        <input type="text" id="pName" placeholder="Partner's Name">
        <textarea id="pMsg" placeholder="Type your special message..."></textarea>
        <p style="font-size: 12px; color: var(--p); margin-top: 5px;">Paste 6 Image URLs (One per line):</p>
        <textarea id="imgUrls" rows="4" placeholder="https://site.com/photo1.jpg&#10;https://site.com/photo2.jpg"></textarea>
        <button class="btn btn-p" onclick="generateAndStart()">Generate Surprise ‚ú®</button>
    </div>

    <div id="step-loading" class="card hidden">
        <h2 style="font-family: var(--f); color: var(--p);">Cuteness Loading...</h2>
        <h1 id="perc" style="font-size: 50px; color: var(--p); font-family: var(--f);">0%</h1>
        <button id="tapBtn" class="btn hidden" style="background:white; color:#ff3385;" onclick="startTyping()">Tap to Open üíå</button>
    </div>

    <div id="step-typing" class="card hidden">
        <div id="animatedText" class="typing-text"></div>
        <button id="nextBtn" class="btn btn-p hidden" onclick="goToPropose()">Next ‚ú®</button>
    </div>

    <div id="step-propose" class="card hidden">
        <img src="panda.gif" style="width: 120px; margin-bottom: 10px; border-radius: 15px;">
        <div class="letter-box">
            <span id="displayPartnerName" class="name-h"></span>
            <p style="font-family: var(--s); font-size: 22px; color: var(--p);">Will you be my Valentine? ü•∫</p>
        </div>
        <button class="btn btn-p" onclick="showMemories()">YES ü•∞</button>
        <button id="noBtn" class="btn" style="background:#eee;" onmouseover="moveNo()">NO ü•∫</button>
    </div>

    <div id="step-final" class="card hidden">
        <h2 id="galleryTitle" style="font-family: var(--f); color: var(--p); font-size: 20px;"></h2>
        <div id="photoGallery" class="photo-gallery"></div>
        <p id="finalQuoteText" class="final-quote">
            "I fell in love with you because of the million things you never knew you were doing."
        </p>
        <h3 class="name-h" style="margin-top:10px; font-size: 22px;">Forever Yours! ‚ù§Ô∏è</h3>
        <button class="btn btn-p" style="font-size: 16px;" onclick="copyLink()">üîó Copy Link to Share</button>
    </div>

    <script>
        let partnerName = "", message = "", photoList = [];
        const audio = document.getElementById('bgMusic');

        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if (params.has('n')) {
                partnerName = decodeURIComponent(params.get('n'));
                message = decodeURIComponent(params.get('m'));
                const p = params.get('p');
                if(p) photoList = p.split(',');
                
                document.getElementById('step-1').classList.add('hidden');
                document.getElementById('step-loading').classList.remove('hidden');
                startLoadingBar();
            }
        };

        function generateAndStart() {
            const n = document.getElementById('pName').value;
            const m = document.getElementById('pMsg').value;
            const urls = document.getElementById('imgUrls').value.split('\n').filter(u => u.trim() !== "").join(',');
            
            if (!n || !m) return alert("Please enter Name and Message!");
            
            const newUrl = `${window.location.origin}${window.location.pathname}?n=${encodeURIComponent(n)}&m=${encodeURIComponent(m)}&p=${encodeURIComponent(urls)}`;
            window.history.pushState({}, '', newUrl);
            location.reload(); 
        }

        function startLoadingBar() {
            audio.play().catch(() => {});
            let w = 0;
            const int = setInterval(() => {
                w++;
                document.getElementById('perc').innerText = w + "%";
                if (w >= 100) { clearInterval(int); document.getElementById('tapBtn').classList.remove('hidden'); }
            }, 30);
        }

        function startTyping() {
            document.getElementById('step-loading').classList.add('hidden');
            document.getElementById('step-typing').classList.remove('hidden');
            let i = 0;
            function type() {
                if (i < message.length) {
                    document.getElementById('animatedText').innerHTML += message.charAt(i);
                    i++; setTimeout(type, 70);
                } else { document.getElementById('nextBtn').classList.remove('hidden'); }
            }
            type();
        }

        function goToPropose() {
            document.getElementById('step-typing').classList.add('hidden');
            document.getElementById('step-propose').classList.remove('hidden');
            document.getElementById('displayPartnerName').innerText = partnerName;
        }

        function showMemories() {
            document.getElementById('step-propose').classList.add('hidden');
            document.getElementById('step-final').classList.remove('hidden');
            document.getElementById('galleryTitle').innerText = `${partnerName}'s Memories ‚ú®`;
            const gallery = document.getElementById('photoGallery');
            
            photoList.forEach((src, idx) => {
                const img = document.createElement('img');
                img.src = src.trim();
                img.onerror = () => img.src = "https://via.placeholder.com/150?text=Invalid+Link";
                gallery.appendChild(img);
                setTimeout(() => img.classList.add('show'), 400 + (idx * 300));
            });
            setTimeout(() => document.getElementById('finalQuoteText').classList.add('show'), 1500);
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href);
            alert("Perfect! Link Copied. Share it! ‚ù§Ô∏è");
        }

        function toggleMute() { audio.muted = !audio.muted; }
        function moveNo() {
            const b = document.getElementById('noBtn');
            b.style.position = 'fixed';
            b.style.left = Math.random() * 70 + '%'; b.style.top = Math.random() * 70 + '%';
        }
    </script>
</body>
</html>
